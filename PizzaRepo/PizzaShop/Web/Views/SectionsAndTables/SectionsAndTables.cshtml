@model List<Entity.ViewModel.SectionViewModel>
@{
    Layout = "~/Views/Shared/_SecondLayout.cshtml";
    ViewData["Title"] = "Sections";
}
<div class="row my-4 px-3">
    <div class="col-6 text-Users-title fs-2">Sections/Tables</div>
</div>
<div class="row mx-2">
    <!-- Sections Column -->
    <div class="col-md-3"> <!-- Increased column width -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <p class="fs-5 text-Users-title">Sections</p>
            <button class="send-button" data-bs-toggle="modal" data-bs-target="#addSectionModal">
                <i class="material-icons">add</i>
            </button>
        </div>

        <div class="list-group" id="sectionList">
            @foreach (var Section in Model)
            {
                <a href="#" class="list-group-item list-group-item-action section-item"
                    data-section-id="@Section.Sectionid">
                    @Section.Sectionname
                    <span class="icon-container">
                        <i class="material-icons"
                            onclick="event.stopPropagation(); editSection(@Section.Sectionid)">edit</i>
                        <i class="material-icons"
                            onclick="event.stopPropagation(); deleteSection(@Section.Sectionid)">delete</i>
                    </span>
                </a>
            }
        </div>
    </div>

    <div class="col-md-9">
        <div class="row">
            <p class="col-2 text-Users-title font-weight-bold fs-5">Tables</p>

            <div class="d-flex col-10 mb-3 justify-content-end align-items-center">
                <div class="col-6">

                </div>
                <input type="text" class="form-control col mx-2 p-3" id="searchItem" placeholder="Search tables">

                <button class="col delete-user mx-2 p-3" data-bs-toggle="modal" data-bs-target="#massDeleteItems">
                    <img src="~/images/delete-icon.png" alt="" height="20px" width="20px"></button>

                <button class="add-user-button m-2 p-3" data-bs-toggle="modal" data-bs-target="#addItemModal">+ New
                    Table</button>

            </div>
        </div>
        <div class="table-responsive">
            <table class="table" id="itemsTable">
                <thead>
                    <tr>
                        <th scope="col"><input class="form-check-input" type="checkbox" value="" disabled></th>
                        <th scope="col" class="text-black-50">Name</th>
                        <th scope="col" class="text-black-50">Item Type</th>
                        <th scope="col" class="text-black-50">Rate</th>
                        <th scope="col" class="text-black-50">Quantity</th>
                        <th scope="col" class="text-black-50">Available</th>
                        <th scope="col" class="text-black-50">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tables will be dynamically loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="modal fade" id="addSectionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addSectionForm">
                    <div class="mb-3 form-floating">
                        <input type="text" class="form-control" id="SectionName" required>
                        <label for="SectionName" class="form-label">Name*</label>
                    </div>
                    <div class="mb-3 form-floating">
                        <textarea class="form-control" id="SectionDescription" rows="3"></textarea>
                        <label for="SectionDescription" class="form-label">Description</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="send-button px-3 py-1" id="saveSection">Save</button>
                <button type="button" class="back-button px-3 py-1" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div id="sectionDeleteModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img src="~/images/danger.png" width="50" height="50" alt="Warning">
                <p class="mt-3">Are you sure you want to delete this section?</p>
                <input type="hidden" id="sectionToDelete">
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="send-button px-3 py-1" id="confirmSectionDelete">Yes</button>
                <button type="button" class="back-button px-3 py-1" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editSectionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editSectionForm">
                    <input type="hidden" id="editSectionId">
                    <div class="mb-3 form-floating">
                        <input type="text" class="form-control" id="editSectionName" required>
                        <label for="editSectionName" class="form-label">Name</label>
                    </div>
                    <div class="mb-3 form-floating">
                        <textarea class="form-control" id="editSectionDescription" rows="3"></textarea>
                        <label for="editSectionDescription" class="form-label">Description</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="send-button px-3 py-1" id="updateSection">Save</button>
                <button type="button" class="back-button px-3 py-1" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<script>
    const sectionDeleteModal = new bootstrap.Modal(document.getElementById('sectionDeleteModal'));
    function deleteSection(sectionId) {

        document.getElementById('sectionToDelete').value = sectionId;
        sectionDeleteModal.show();
    }
    function editSection(sectionId) {
            fetch(`/SectionsAndTables/GetSection/${sectionId}`)
                .then(response => response.json())
                .then(section => {
                    document.getElementById('editSectionId').value = section.sectionid;
                    document.getElementById('editSectionName').value = section.sectionname;
                    document.getElementById('editSectionDescription').value = section.description;

                    const editModal = new bootstrap.Modal(document.getElementById('editSectionModal'));
                    editModal.show();
                });
        }
    window.addEventListener("DOMContentLoaded", (event) => {
        document.getElementById('saveSection').addEventListener('click', () => {
            const SectionName = document.getElementById('SectionName').value;
            const SectionDescription = document.getElementById('SectionDescription').value;
            fetch('/SectionsAndTables/AddSection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    SectionName: SectionName,
                    description: SectionDescription
                })
            })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Failed to add Section');
                    }
                });
        });

        document.getElementById('confirmSectionDelete').addEventListener('click', function () {
            const sectionId = document.getElementById('sectionToDelete').value;

            fetch(`/SectionsAndTables/DeleteSection?sectionid=${sectionId}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Failed to delete section');
                    }
                })
                .finally(() => {
                    sectionDeleteModal.hide();
                });
        });

        document.getElementById('updateSection').addEventListener('click', () => {
            const sectionData = {
                SectionId: document.getElementById('editSectionId').value,
                Sectionname: document.getElementById('editSectionName').value,
                Description: document.getElementById('editSectionDescription').value
            };

            fetch('/SectionsAndTables/UpdateSection', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(sectionData)
            })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Failed to update section');
                    }
                });
        });
    });
</script>