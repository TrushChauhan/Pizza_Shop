@model List<Entity.ViewModel.TaxViewModel>
@{
  Layout = "~/Views/Shared/_SecondLayout.cshtml";
  ViewData["Title"] = "Taxes";
}

<div class="row-11 d-flex my-2">
  <div class="col-6 text-Users-title fs-2">
    Taxes/Fees
  </div>
  <div class="col-6 d-flex justify-content-end">
    <input type="text" class="m-2" placeholder="Search">

    <button class="send-button m-2">
      + New Tax
    </button>
  </div>
</div>
<div class="table-responsive tax-table row m-3">
  <table class="table">
    <thead>
      <tr>
        <th scope="col" class="text-black-50">Name</th>
        <th scope="col" class="text-black-50">Type</th>
        <th scope="col" class="text-black-50">IsEnabled</th>
        <th scope="col" class="text-black-50">Tax Value</th>
        <th scope="col" class="text-black-50">Action</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var tax in Model)
      {
        <tr data-user-id="@tax.Taxid">
          <td>
            @tax.Taxname
          </td>
          <td>@tax.Taxtype</td>
          <td>@tax.Isenabled</td>
          <td>@tax.Taxamount</td>
          <td>
            <i class="material-icons">edit</i>
            <i class="material-icons delete-tax" onclick="deleteTax(@tax.Taxid)">delete</i>
          </td>
        </tr>
      }
    </tbody>
  </table>

<div id="taxDeleteModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img src="~/images/danger.png" width="50" height="50" alt="Warning">
                <p class="mt-3">Are you sure you want to delete this tax?</p>
                <input type="hidden" id="taxToDelete">
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-primary" id="confirmTaxDelete" >Yes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<script>
  const taxDeleteModal = new bootstrap.Modal(document.getElementById('taxDeleteModal'));

    function deleteTax(taxid) {
        document.getElementById('taxToDelete').value = taxid;
        taxDeleteModal.show();
    }

    document.getElementById('confirmTaxDelete').addEventListener('click', function () {
        const taxId = document.getElementById('taxToDelete').value;
        console.log(taxId);
        fetch(`/Tax/DeleteTax/${taxId}`, {
            method: 'POST'
        })
            .then(response => {
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to delete tax');
                }
            })
            .finally(() => {
                taxDeleteModal.hide();
            });
    });
</script>